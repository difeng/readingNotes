#1.1 mysql逻辑架构
mysql逻辑架构图:
![](http://7xawio.com1.z0.glb.clouddn.com/mysql_1_%E6%9E%B6%E6%9E%84%E5%9B%BE.png)
第一层：连接处理、授权认证、安全等等

第二层：查询解析、分析、优化、缓存以及所有内置函数，所有存储引擎的功能都在这一层实现：存储过程、触发器、视图等

第三层：存储引擎。存储引擎负责MySql中的数据的存储和提取


###服务器端缓存查询线程，每一个客户端连接上来都使用一个线程。


###使用explain查看优化器的优化过程，可通过重构查询和schema、修改配置来调优sql使之可能高效运行。


###对于select语句，在解析查询之前会先检查查询缓存(Query Cache)。如果能命中，则会直接返回其中的结果器，不必再解析查询。


###并发控制使用
读写锁

粒度锁

事务


隔离级别
  READ UNCOMMITTED(未提交读)
  READ COMMITTED(提交读)
  REPEATABLE READ(可重复读)
  SERIALIZABLE(可串行化)
  
![](http://7xawio.com1.z0.glb.clouddn.com/mysql_1_%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB.png)

死锁

##6 mysql查询性能优化

###查询状态
对于mysql的一个连接，或者说是线程，任何时刻都有一个状态，这个状态表示mysql当前正在做什么
* Sleep 线程正在等待客户端发送新的请求
* Query 线程正在执行查询或者正在将结果发送给客户端
* Locked 该线程正在等待表锁
* Analyzing and statistics 线程正在收集存储引擎的统计信息，并生成查询的执行计划
* Copy to tmp table [on disk]线程正在执行查询，并且将其结果集都复制到一个临时表中，这种状态要么在做group by操作，要么是文件排序操作，或者时union操作
* Sending data 这表示多种情况:线程可能在多个状态间传送数据，或者生成结果集，或者在向客户端返回数据


###mysql排序优化

####两次传输排序
1.读取行指针和需要排序的字段，对其排序
2.根据排序结果读取所需要的数据行

####单次传输排序
读取查询所需要的所有列，然后再根据给定列进行排序，最后直接返回排序结果

###查询执行引擎
#####关联子查询
如下的伪查询语句：
A union B limit 20 

union会把A，B两个表的都存放到一个临时表中，然后从临时表中拿出前20条。

####UNION的限制


####索引合并优化








